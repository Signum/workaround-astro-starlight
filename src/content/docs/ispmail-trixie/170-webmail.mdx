---
title: Webmail using Roundcube
lastUpdated: 2025-08-25
slug: ispmail-trixie/webmail
sidebar:
  order: 170
---

import { Aside } from "@astrojs/starlight/components";

## Configure Apache

Now that the email has arrived, our valued user surely wants to read it. Most humans nowadays seem to prefer reading
their email in the web browser, because it's the simplest way. (Don't worry. Power users who prefer mail clients like
Thunderbird will also get what they want.) So let's prepare [Roundcube](https://roundcube.net/) for them.

<details class="collapsible">
  <summary>Click here to learn more about virtual hosts…</summary>

A web server like Apache has the job of answering HTTP or HTTPS requests from people’s browsers. Running just a single
website per server (or per IP address) would be both inefficient and limiting, so the idea of _virtual hosts_ was
introduced. With virtual hosts, one server can host many different websites. The browser helps by sending a
`Host: mail.example.org` header with each request, which tells the server which website it should serve. This works fine
for HTTP—though plain HTTP is rarely used anymore.

With HTTPS, things get trickier. Browsers expect the server to present a TLS certificate that matches the domain being
requested. If you try to open mail.example.org but the server responds with a certificate for shop.example.org, the
browser will block the connection. That means the server needs to know which domain the browser is asking for before the
encrypted connection is set up.

The solution is a feature called SNI (Server Name Indication). When establishing an HTTPS connection, the browser
includes the domain name it wants in the handshake. This allows the server to pick the correct TLS certificate right
from the start.

Fortunately you do not have to worry about it that much because Apache is doing the heavy lifting for you. A virtual
host configuration essentially looks like:

```
<VirtualHost *:443>
  ServerName mail.example.org
  SSLCertificateFile /etc/letsencrypt/live/mail.example.org/fullchain.pem
  SSLCertificateKeyFile /etc/letsencrypt/live/mail.example.org/privkey.pem
  Include /etc/letsencrypt/options-ssl-apache.conf
</VirtualHost>
```

There are two directories dealing with virtual hosts:

- /etc/apache2/sites-available
- /etc/apache2/sites-enabled

The actual file containing the configuration lives in _sites-available_. If that configuration should be active, then a
symbolic link (symlink) is added to the _sites-enabled_ directory pointing to the file in the _sites-available_
directory. That way you can switch sites on and off without deleting the actual configuration file. You can enable a
site using the `a2enconf` (apache2 enable config) command or disable it using `a2disconf`.

</details>

Since you ran `certbot` already to create a TLS certificate for your site, the default configuration files for HTTP and
HTTPS have been adapted already:

- **000-default.conf**: This is the virtual host configuration for HTTPS requests. It uses a `RewriteRule` to redirect
  users to the HTTPS site.
- **000-default-le-ssl.conf**: This is the HTTPS virtual host.

So to get Apache to serve the Roundcube application you need to edit the
`/etc/apache2/sites-available/000-default-le-ssl.conf` file and add/set:

```
ServerName mail.example.org
DocumentRoot /var/lib/roundcube/public_html
Include /etc/roundcube/apache.conf
```

Meaning:

- `ServerName` sets the domain name that a user's browser will request.
- `DocumentRoot` points the entire web site to the directory where Roundcube is installed.
- `Include` loads additional security settings that the Roundcube package provides.

And as usual Apache needs to be restarted after the configuration change:

```
systemctl restart apache2
```

Check that Apache is running properly:

```
systemctl status apache2
```

In case of a problem run “`apache2ctl configtest`” to find the cause.

## Limit access to localhost

The main configuration file of Roundcube is located at `/etc/roundcube/config.inc.php`. Feel free to customize the file.
Fortunately nowadays the basic settings are already as we need them. However these two settings need to be changed by
you:

```
$config['imap_host'] = "tls://webmail.example.org:143";
$config['smtp_host'] = 'tls://webmail.example.org:587';
```

So now when your users enter `https://webmail.example.org/` in their browser they should get the Roundcube login form:

Keep in mind that we are using the email address as the account name of the user. So when logging in please enter the
email address as the user name. E.g. ‘john@example.org’ and password ‘summersun’.

<Aside type="tip" title="Login failed? Storage server can’t be reached?">
  In that case please double check your Dovecot 10-ssl.conf file if you set the path to your Let’s Encrypt certificate
  correctly. Also check the /var/lib/roundcube/logs/errors.log file for errors.
</Aside>

## Plugins

Roundcube comes with various plugins that you can offer your users. I recommend at least these two:

- password: Let the user change their access password.
- managesieve: Let the user manage rules that apply to incoming email. They can move mails to specific folders
  automatically for example.

Again edit the `/etc/roundcube/config.inc.php` file and look for the _plugins_ configuration. To enable the recommended
plugins change it to:

```
$config['plugins'] = array(
     'managesieve',
     'password',
 );
```

### password plugin

Plugins are configured through files located in the `/etc/roundcube/plugins` directory. Let’s begin with the password
plugin. Edit the `/etc/roundcube/plugins/password/config.inc.php` file.

Oops, that file looks pretty empty. But it refers us to an example file at
`/usr/share/roundcube/plugins/password/config.inc.php.dist`. There are many different methods to let users change their
passwords. As we store that information in the SQL database, that is the part we need to set up.

<Aside type="tip" title="No more doveadm">
  In previous versions of this guide I used the “doveadm pw” command to generate passwords. This is no longer needed.
  Roundcube can now generate the passwords in the right format to be understood by Dovecot.
</Aside>

Remove the empty definition line of $config from your `config.inc.php` file. Let’s go through the required settings one
by one:

- `$config['password_driver'] = 'sql';`\
   Simple. Use SQL as a backend.
- `$config['password_minimum_length'] = 12;`\
   Allow no passwords shorter than 12 characters. I consider longer passwords more secure than short passwords with
  weird characters. You can even choose a larger minimum.
- `$config['password_force_save'] = true;`\
   This will overwrite the password in the database even if it hasn’t changed. It helps us improve the strength of the
  password hash by re-encoding it with a better algorithm even if the user chooses to keep his old password.
- `$config['password_algorithm'] = 'blowfish-crypt';`\
   The cryptographic algorithm to encode the password. This one is considered very secure and supported by Dovecot.
- `$config['password_algorithm_prefix'] = '{CRYPT}';`\
   Prepend every password with this string so that Dovecot knows how we encrypted the password.
- `$config['password_db_dsn'] = 'mysql://mailadmin:gefk6lA2brMOeb8eR5WYaMEdKDQfnF@localhost/mailserver';`\
   Connection information for the local database. Use your own password for the _mailadmin_ (!) database user here. We
  cannot use the restricted _mailserver_ user because we have to write to the database if the user changes his password.
- `$config['password_query'] = "UPDATE virtual_users SET password=%P WHERE email=%u";`\
   The SQL query that is run to write the new password hash into the database. %P is a placeholder for the new password
  hash. And %u is the logged-in user and conveniently matches the email address.

Make sure that this config file is not world-readable:

```
chown root:www-data /etc/roundcube/plugins/password/config.inc.php
chmod u=rw,g=r,o= /etc/roundcube/plugins/password/config.inc.php
```

Try it. Log into Roundcube as `john@example.org` with password ‘summersun’. Go to the _Settings_. Choose _Password_.
Enter a new password twice. You should get a success message at the bottom right. Now logout and login with the new
password. Does it work? Great.

### sieve plugin

[Sieve](<https://en.wikipedia.org/wiki/Sieve_(mail_filtering_language)>) is a simple programming language to be used for
server-side rules. Dovecot executes these rules every time a new email comes in. There are global rules that are
executed for every email. And of course every user/mailbox can have its own rules. To manage sieve rules Dovecot offers
the _managesieve_ interface that you enabled earlier. So we just need to tell Roundcube how to access it.

The configuration file for Roundcube’s _managesieve_ plugin is found at
`/etc/roundcube/plugins/managesieve/config.inc.php`. Edit the file and again remove the empty or comment the `$config`
line. You can again find all possible configuration options in the
`/usr/share/roundcube/plugins/managesieve/config.inc.php.dist` file.

This time just one setting is required to tell Roundcube which server to talk to:

```
$config['managesieve_host'] = 'localhost';
```

Sieve rules are stored in a special syntax on the server. This is an example that moves all incoming emails to the
_test_ folder that have “test” in the subject:

```
require ["fileinto"];
if header :contains "subject" "test"
{
  fileinto "INBOX/test";
}
```

You do not need to learn this syntax though. Roundcube’s sieve rule editor is way more user-friendly.

Try adding a sieve rule for `john@example.org` in Roundcube. That feature is located in Settings/Filters. You will find
the machine-readable sieve code at `/var/vmail/example.org/john/sieve/roundcube.sieve`.

The rule editor looks like this:
